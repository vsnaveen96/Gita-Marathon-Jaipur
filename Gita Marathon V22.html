<html><head><base href="." />
<title>ISKCON Jaipur Book Distribution Dashboard - Enhanced</title>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
* {
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

body {
  margin: 0;
  padding: 10px;
  background: #f0f2f5;
  min-height: 100vh;
}

.dashboard {
  max-width: 1400px;
  margin: 0 auto;
  padding: 10px;
}

.auth-container {
  position: absolute;
  top: 20px;
  right: 20px;
  z-index: 10;
}

.auth-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(255,255,255,0.2);
  color: white;
  border: 1px solid rgba(255,255,255,0.3);
  padding: 8px 16px;
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.auth-btn:hover {
  background: rgba(255,255,255,0.3);
  transform: translateY(-2px);
}

.auth-btn svg {
  transition: transform 0.3s ease;
}

.auth-btn:hover svg {
  transform: translateX(3px);
}

.mantra-marquee {
  background: linear-gradient(135deg, #5c2684 0%, #3f1f5c 100%);
  color: white;
  padding: 10px;
  margin-bottom: 20px;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(92, 38, 132, 0.1);
  overflow: hidden;
  font-size: 1.2em;
}

.mantra-text {
  display: inline-block;
  animation: scrollText 20s linear infinite;
  white-space: nowrap;
  padding-left: 100%;
}

@keyframes scrollText {
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(-100%);
  }
}

.header {
  background: linear-gradient(135deg, #5c2684 0%, #3f1f5c 100%);
  border-radius: 15px;
  padding: 20px 20px;
  margin-bottom: 25px;
  box-shadow: 0 8px 32px rgba(92, 38, 132, 0.15);
  text-align: center;
  position: relative;
  overflow: hidden;
}

.header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(circle at top right, rgba(255,255,255,0.1) 0%, transparent 60%);
}

.header h1 {
  font-size: 2.8em;
  font-weight: 700;
  margin-bottom: 15px;
  color: white;
  text-shadow: 0 2px 4px rgba(0,0,0,0.2);
  position: relative;
}

.header p {
  color: rgba(255, 255, 255, 0.9);
  font-size: 1.3em;
  font-weight: 300;
  max-width: 600px;
  margin: 0 auto;
  position: relative;
  letter-spacing: 0.5px;
}

.header h1, .header p {
  animation: headerFadeIn 0.8s ease-out forwards;
}

@keyframes headerFadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 25px;
  margin: 30px 0;
}

.stat-card {
  background: white;
  border: none;
  box-shadow: 0 4px 20px rgba(26, 115, 232, 0.1);
  position: relative;
  overflow: hidden;
  padding: 25px;
  border-radius: 15px;
  transition: transform 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-5px);
}

.stat-card h3 {
  color: #5c2684;
  font-size: 1.2em;
  margin-bottom: 15px;
}

.stat-card .number {
  font-size: 2.4em;
  margin: 10px 0;
  background: linear-gradient(45deg, #5c2684, #3f1f5c);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 600;
  animation: numberPulse 2s infinite;
}

@keyframes numberPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.filter-container, .data-input {
  display: none; /* Hide by default */
  opacity: 0;
  transform: translateY(-10px);
  transition: all 0.3s ease;
}

.filter-container.show, .data-input.show {
  display: block;
  opacity: 1;
  transform: translateY(0);
}

.form-group {
  margin-bottom: 15px;
  position: relative;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  color: #444;
  font-weight: 500;
  font-size: 1em;
  transition: color 0.3s ease;
}

.form-group:hover label {
  color: #5c2684;
}

input, select {
  width: 100%;
  padding: 8px 12px;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  font-size: 1em;
  transition: all 0.3s ease;
  background: #ffffff;
  color: #333;
  appearance: none;
  -webkit-appearance: none;
}

input:hover, select:hover {
  border-color: #5c2684;
  background: #fff;
}

input:focus, select:focus {
  border-color: #5c2684;
  box-shadow: 0 0 0 4px rgba(92, 38, 132, 0.1);
}

#distributor-pledge {
  width: 100%;
  padding: 8px 12px;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  font-size: 1em;
  transition: all 0.3s ease;
  background: #ffffff;
  color: #333;
}

#distributor-pledge:hover {
  border-color: #5c2684;
  background: #fff;
}

#distributor-pledge:focus {
  border-color: #5c2684;
  box-shadow: 0 0 0 4px rgba(92, 38, 132, 0.1);
}

#subteam-new {
  width: 100%;
  padding: 8px 12px;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  font-size: 1em;
  transition: all 0.3s ease;
  background: #ffffff;
  color: #333;
}

#subteam-new:hover {
  border-color: #5c2684;
  background: #fff;
}

#subteam-new:focus {
  border-color: #5c2684;
  box-shadow: 0 0 0 4px rgba(92, 38, 132, 0.1);
}

#distribution-form {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 25px;
}

.button-group {
  display: flex;
  gap: 20px;
  margin-top: 30px;
  flex-wrap: wrap;
}

button {
  background: linear-gradient(135deg, #5c2684 0%, #3f1f5c 100%);
  color: white;
  border: none;
  padding: 12px 25px;
  border-radius: 12px;
  font-weight: 600;
  font-size: 1.05em;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  letter-spacing: 0.5px;
}

button:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(92, 38, 132, 0.2);
}

button:active {
  transform: translateY(-1px);
}

@keyframes formFadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.form-group {
  animation: formFadeIn 0.5s ease-out forwards;
  animation-delay: calc(var(--animation-order) * 0.1s);
}

.data-input::before, .filter-container::before {
  content: '';
  position: absolute;
  top: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, rgba(92, 38, 132, 0.1) 0%, rgba(63, 31, 92, 0.1) 100%);
  border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
  z-index: 0;
}

@media (max-width: 768px) {
  .data-input, .filter-container {
    padding: 20px;
  }

  .button-group {
    flex-direction: column;
  }

  button {
    width: 100%;
  }
}

.progress-bar {
  height: 12px;
  background: #e3f2fd;
  border-radius: 10px;
  overflow: hidden;
  margin: 10px 0;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #5c2684, #3f1f5c);
  border-radius: 10px;
  transition: width 1s ease-in-out;
  position: relative;
  overflow: hidden;
}

.achiever-card {
  background: linear-gradient(135deg, #5c2684 0%, #3f1f5c 100%) !important;
  color: white !important;
  padding: 35px;
  border-radius: 15px;
  box-shadow: 0 4px 20px rgba(52, 168, 83, 0.2);
  margin: 0;
  position: relative;
  overflow: hidden;
}

.table-container {
  background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
  padding: 30px;
  border-radius: 15px;
  margin-top: 15px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

table {
  width: 100%;
  border-spacing: 0;
}

th {
  background: #5c2684;
  color: white;
  font-weight: 500;
  padding: 15px;
}

td {
  padding: 15px;
  border-bottom: 1px solid #eee;
}

tr:hover {
  background: linear-gradient(90deg, #f8f9ff 0%, #ffffff 100%);
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.dashboard > * {
  animation: fadeInUp 0.5s ease-out forwards;
  animation-delay: calc(var(--animation-order) * 0.1s);
}

.stat-card {
  --animation-order: 1;
}

.filter-container {
  --animation-order: 2;
}

.data-input {
  --animation-order: 3;
}

.action-buttons {
  display: flex;
  gap: 15px;
  margin: 20px 0;
  justify-content: center;
  padding: 0 20px;
}

.icon-button {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px;
  border-radius: 10px;
  border: none;
  background: #5c2684;
  color: white;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 1em;
  font-weight: 500;
}

.icon-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(92, 38, 132, 0.2);
}

.icon-button svg {
  width: 20px;
  height: 20px;
}

.filter-container.show, .data-input.show {
  margin-bottom: 25px;  /* Add some spacing after the active form */
}

#distribution-form button[type="submit"] {
  grid-column: 1 / -1;
  margin-top: 15px;
  padding: 10px;
  font-size: 1.1em;
  background: linear-gradient(135deg, #5c2684 0%, #3f1f5c 100%);
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
}

#distribution-form button[type="submit"]:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(92, 38, 132, 0.2);
}

@keyframes inputPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.02); }
  100% { transform: scale(1); }
}

.filter-container button {
  padding: 8px 16px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.filter-container button:before {
  content: '';
  width: 20px;
  height: 20px;
  background-size: contain;
  background-repeat: no-repeat;
}

.export-btn:before {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3E%3Cpath d='M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z'/%3E%3C/svg%3E");
}

.distributor-list {
  display: none;
  margin-top: 15px;
  padding: 10px;
  background: rgba(92, 38, 132, 0.05);
  border-radius: 8px;
  max-height: 300px; /* Increased height to accommodate teams */
  overflow-y: auto;
}

.distributor-list.show {
  display: block;
}

.toggle-distributors {
  background: none;
  border: none;
  color: #5c2684;
  cursor: pointer;
  padding: 5px;
  margin-top: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  transition: all 0.3s ease;
}

.toggle-distributors:hover {
  transform: translateY(0);
  box-shadow: none;
  opacity: 0.8;
}

.toggle-distributors svg {
  width: 20px;
  height: 20px;
  transition: transform 0.3s ease;
}

.toggle-distributors.active svg {
  transform: rotate(180deg);
}

.clear-btn {
  background: linear-gradient(135deg, #666 0%, #444 100%) !important;
}

.clear-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}

/* Add these styles */
datalist {
    display: none; /* Hide the datalist element itself */
}

input[list]::-webkit-calendar-picker-indicator {
    opacity: 0.5;
    cursor: pointer;
}

/* Style the input when suggestions are available */
input[list]:focus {
    border-color: #5c2684;
    box-shadow: 0 0 0 4px rgba(92, 38, 132, 0.1);
}

/* Add these styles to support input list with custom values */
#marathon-type-new,
#distributor-name-new {
  margin-top: 10px;
}

@media (max-width: 768px) {
  .data-input, .filter-container {
    padding: 20px;
  }
  
  .button-group {
    flex-direction: column;
  }
  
  button {
    width: 100%;
  }
}

.suggestions-dropdown {
  position: absolute;
  width: 100%;
  max-height: 200px;
  overflow-y: auto;
  background: white;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  margin-top: 5px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  z-index: 1000;
  display: none;
}

.suggestions-dropdown.show {
  display: block;
}

.suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  transition: background 0.2s;
}

.suggestion-item:hover {
  background: rgba(92, 38, 132, 0.1);
}

.form-group {
  position: relative;  /* Add this to properly position the dropdown */
}

option[value="other"] {
  color: #5c2684 !important;
  font-weight: 500;
}

/* Pagination styles */
.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 20px;
  gap: 10px;
}

.pagination button {
  padding: 8px 15px;
  border-radius: 8px;
  background: transparent;
  color: #5c2684;
  border: 2px solid #5c2684;
  cursor: pointer;
  transition: all 0.3s ease;
}

.pagination button:hover {
  background: rgba(92, 38, 132, 0.1);
}

.pagination button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  border-color: #ccc;
  color: #ccc;
}

.pagination .page-info {
  color: #5c2684;
  font-weight: 500;
}

.entries-per-page {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
}

.entries-per-page select {
  padding: 5px 10px;
  border-radius: 8px;
  border: 2px solid #5c2684;
  color: #5c2684;
  background: white;
}

/* Add these styles */
.graph-container {
  background: white;
  border-radius: 15px;
  padding: 20px;
  margin: 25px 0;
  box-shadow: 0 4px 20px rgba(92, 38, 132, 0.1);
}

.graph-container h2 {
  color: #5c2684;
  margin-bottom: 20px;
  font-size: 1.5em;
}

canvas {
  width: 100% !important;
  height: 400px !important;
}

/* Add these styles to the existing CSS */
.team-distributors {
  margin-bottom: 20px;
  background: rgba(92, 38, 132, 0.03);
  border-radius: 8px;
  padding: 15px;
}

.team-name {
  color: #5c2684;
  font-weight: 600;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 2px solid rgba(92, 38, 132, 0.1);
  font-size: 1.1em;
}

.team-members {
  padding-left: 20px;
}

.distributor-name {
  padding: 5px 0;
  color: #444;
  font-size: 0.95em;
  display: flex;
  align-items: center;
}

.no-data {
  color: #666;
  text-align: center;
  padding: 20px;
  font-style: italic;
}

.action-icons {
  display: flex;
  gap: 8px;
  justify-content: center;
}

.icon-button.edit-icon,
.icon-button.delete-icon {
  background: none;
  border: none;
  padding: 5px;
  cursor: pointer;
  transition: all 0.2s ease;
  border-radius: 4px;
}

.icon-button.edit-icon {
  color: #5c2684;
}

.icon-button.delete-icon {
  color: #dc3545;
}

.icon-button.edit-icon:hover,
.icon-button.delete-icon:hover {
  transform: translateY(-2px);
  background: rgba(0, 0, 0, 0.05);
}

.icon-button.edit-icon:active,
.icon-button.delete-icon:active {
  transform: translateY(0);
}

/* Add this to the existing table styles */
th:last-child {
  min-width: 100px;
}

/* Add these styles for the custom delete confirmation modal */
.modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  backdrop-filter: blur(4px);
}

.modal-container {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 4px 25px rgba(0, 0, 0, 0.15);
  max-width: 400px;
  width: 90%;
  z-index: 1001;
  text-align: center;
}

.modal-header {
  margin-bottom: 20px;
}

.modal-header svg {
  width: 50px;
  height: 50px;
  color: #dc3545;
  margin-bottom: 15px;
}

.modal-title {
  font-size: 1.5em;
  color: #333;
  margin-bottom: 10px;
}

.modal-message {
  color: #666;
  margin-bottom: 25px;
  line-height: 1.5;
}

.modal-buttons {
  display: flex;
  gap: 15px;
  justify-content: center;
}

.modal-btn {
  padding: 10px 25px;
  border-radius: 8px;
  border: none;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
}

.modal-btn.confirm {
  background: #dc3545;
  color: white;
}

.modal-btn.cancel {
  background: #f8f9fa;
  color: #333;
  border: 1px solid #dee2e6;
}

.modal-btn:hover {
  transform: translateY(-2px);
}

.modal-btn.confirm:hover {
  background: #c82333;
}

.modal-btn.cancel:hover {
  background: #e2e6ea;
}

/* Add this CSS for the login modal */
.login-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 2000;
  backdrop-filter: blur(4px);
}

.login-container {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 40px;
  border-radius: 15px;
  box-shadow: 0 4px 25px rgba(0, 0, 0, 0.15);
  max-width: 400px;
  width: 90%;
  text-align: center;
}

.login-header {
  margin-bottom: 25px;
}

.login-header h3 {
  color: #5c2684;
  font-size: 1.8em;
  margin-bottom: 10px;
}

.login-header p {
  color: #666;
  font-size: 0.95em;
}

.login-form {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.login-input {
  padding: 12px;
  border: 2px solid #eee;
  border-radius: 8px;
  font-size: 1em;
  transition: all 0.3s ease;
}

.login-input:focus {
  border-color: #5c2684;
  box-shadow: 0 0 0 4px rgba(92, 38, 132, 0.1);
}

.login-submit {
  background: linear-gradient(135deg, #5c2684 0%, #3f1f5c 100%);
  color: white;
  padding: 12px;
  border: none;
  border-radius: 8px;
  font-size: 1em;
  cursor: pointer;
  transition: all 0.3s ease;
}

.login-submit:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(92, 38, 132, 0.2);
}

.login-options {
  margin-top: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.login-divider {
  display: none;  /* Hide the divider since there's no Google option */
}

.login-error {
  color: #dc3545;
  font-size: 0.9em;
  margin-top: 10px;
  display: none;
}

/* Add these styles */
.close-login {
  position: absolute;
  top: 15px;
  right: 15px;
  background: none;
  border: none;
  cursor: pointer;
  padding: 5px;
  color: #666;
  transition: all 0.3s ease;
}

.close-login:hover {
  color: #333;
  transform: scale(1.1);
}

.login-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  z-index: 2000;
  display: none;
}

/* Add these styles to ensure both charts are properly sized */
.graph-container canvas {
  width: 100% !important;
  height: 400px !important;
}

.graph-container {
  margin-bottom: 25px;
}

/* Add the new styles for distributor list animation */
.team-distributors {
  margin-bottom: 20px;
  background: rgba(92, 38, 132, 0.03);
  border-radius: 8px;
  padding: 15px;
}

.team-name {
  color: #5c2684;
  font-weight: 600;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 2px solid rgba(92, 38, 132, 0.1);
  font-size: 1.1em;
}

.team-members {
  padding-left: 20px;
}

.distributor-name {
  padding: 5px 0;
  color: #444;
  font-size: 0.95em;
  display: flex;
  align-items: center;
}

.no-data {
  color: #666;
  text-align: center;
  padding: 20px;
  font-style: italic;
}

.fade-in {
  animation: fadeIn 0.5s ease forwards;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Add these styles */
#distributor-pledge {
  width: 100%;
  padding: 8px 12px;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  font-size: 1em;
  transition: all 0.3s ease;
  background: #ffffff;
  color: #333;
}

#distributor-pledge:hover {
  border-color: #5c2684;
  background: #fff;
}

#distributor-pledge:focus {
  border-color: #5c2684;
  box-shadow: 0 0 0 4px rgba(92, 38, 132, 0.1);
}

input[type="file"] {
  width: 100%;
  padding: 10px;
  border: 2px dashed #5c2684;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
}

input[type="file"]:hover {
  border-color: #3f1f5c;
  background: rgba(92, 38, 132, 0.05);
}

input[type="file"]::file-selector-button {
  background: linear-gradient(135deg, #5c2684 0%, #3f1f5c 100%);
  color: white;
  padding: 8px 16px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  margin-right: 15px;
  transition: all 0.3s ease;
}

input[type="file"]::file-selector-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(92, 38, 132, 0.2);
}

.form-group small {
  color: #666;
  margin-top: 5px;
  display: block;
  font-size: 0.85em;
}
</style>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let firebaseLoaded = false;
let currentPage = 1;
let rowsPerPage = 10;
window.onValue = null;
window.ref = null;
window.getDbRef = null;
window.serverTimestamp = null;
window.push = null;
window.set = null;
window.remove = null;

let distributionChart = null;
let teamBarChart = null; // Added variable for team bar chart

function initializeChart() {
  const ctx = document.getElementById('distributionChart').getContext('2d');
  
  distributionChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [
        {
          label: 'Total Cumulative',
          data: [],
          borderColor: '#5c2684',
          backgroundColor: 'rgba(92, 38, 132, 0.1)',
          tension: 0.4,
          fill: true,
          order: 1
        },
        {
          label: 'IYF Team',
          data: [],
          borderColor: '#FF6384',
          backgroundColor: 'transparent',
          tension: 0.4,
          fill: false,
          order: 2
        },
        {
          label: 'IGF Team',
          data: [],
          borderColor: '#36A2EB',
          backgroundColor: 'transparent',
          tension: 0.4,
          fill: false,
          order: 3
        },
        {
          label: 'Muralipura Bhakti Vriksha',
          data: [],
          borderColor: '#4BC0C0',
          backgroundColor: 'transparent',
          tension: 0.4,
          fill: false,
          order: 4
        },
        {
          label: 'IYF Bhakti Vriksha',
          data: [],
          borderColor: '#FFCE56',
          backgroundColor: 'transparent',
          tension: 0.4,
          fill: false,
          order: 5
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: {
        intersect: false,
        mode: 'index'
      },
      plugins: {
        legend: {
          position: 'top',
          labels: {
            usePointStyle: true,
            padding: 15
          }
        },
        title: {
          display: true,
          text: 'Book Distribution Progress'
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Books Distributed'
          }
        },
        x: {
          title: {
            display: true,
            text: 'Date'
          },
          ticks: {
            maxRotation: 45,
            minRotation: 45,
            callback: function(value, index, values) {
              // Format the date labels
              const date = this.getLabelForValue(value);
              if (!date) return '';
              const [day, month, year] = date.split('-');
              return `${day}-${month}-${year}`;
            }
          }
        }
      }
    }
  });
}

function initializeTeamBarChart() { // New function for team-wise chart
  const ctx = document.getElementById('teamBarChart').getContext('2d');
  
  teamBarChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [],
      datasets: []
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'top',
        },
        title: {
          display: true,
          text: 'Team-wise Book Distribution'
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const label = context.dataset.label || '';
              const value = context.parsed.y || 0;
              return `${label}: ${value} books`;
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Books'
          }
        },
        x: {
          title: {
            display: true,
            text: 'Teams'
          }
        }
      }
    }
  });
}

function updateChart(distributions) {
  if (!distributionChart) {
    initializeChart();
  }

  const totalMap = new Map();
  const teamMaps = {
    'IYF Team': new Map(),
    'IGF Team': new Map(),
    'Muralipura Bhakti Vriksha': new Map(),
    'IYF Bhakti Vriksha': new Map(),
  };
  
  distributions.forEach(dist => {
    const date = dist.date;
    const quantity = parseInt(dist.quantity) || 0;
    const team = dist.marathonType;
    
    totalMap.set(date, (totalMap.get(date) || 0) + quantity);
    
    if (teamMaps[team]) {
      teamMaps[team].set(date, (teamMaps[team].get(date) || 0) + quantity);
    }
  });

  const allDates = [...new Set(distributions.map(d => d.date))].sort();
  
  const formattedDates = allDates.map(date => {
    const [year, month, day] = date.split('-');
    return `${day}-${month}-${year}`;
  });

  let totalCumulative = 0;
  const totalData = allDates.map(date => {
    totalCumulative += totalMap.get(date) || 0;
    return totalCumulative;
  });

  const teamData = {};
  Object.keys(teamMaps).forEach(team => {
    let cumulative = 0;
    teamData[team] = allDates.map(date => {
      cumulative += teamMaps[team].get(date) || 0;
      return cumulative;
    });
  });

  distributionChart.data.labels = formattedDates;
  distributionChart.data.datasets[0].data = totalData;
  
  Object.keys(teamMaps).forEach((team, index) => {
    distributionChart.data.datasets[index + 1].data = teamData[team];
  });

  distributionChart.update();
}

function updateTeamBarChart(distributions) { // Modified function for team-wise chart
  if (!teamBarChart) {
    initializeTeamBarChart();
  }

  // Calculate team totals and pledges
  const teamTotals = {};
  const teamPledges = {};
  
  distributions.forEach(dist => {
    const team = dist.marathonType;
    if (!teamTotals[team]) {
      teamTotals[team] = 0;
    }
    teamTotals[team] += parseInt(dist.quantity) || 0;
    
    // Track pledges for teams
    if (dist.pledge && !teamPledges[team]) {
      teamPledges[team] = 0;
    }
    if (dist.pledge) {
      teamPledges[team] += parseInt(dist.pledge) || 0;
    }
  });

  // Sort teams by total books distributed
  const sortedTeams = Object.entries(teamTotals)
    .sort((a, b) => b[1] - a[1])
    .filter(([team]) => team); // Filter out empty team names

  teamBarChart.data.labels = sortedTeams.map(([team]) => team);
  teamBarChart.data.datasets = [
    {
      label: 'Books Distributed',
      data: sortedTeams.map(([team]) => teamTotals[team]),
      backgroundColor: [
        'rgba(92, 38, 132, 0.8)',
        'rgba(255, 99, 132, 0.8)',
        'rgba(54, 162, 235, 0.8)',
        'rgba(75, 192, 192, 0.8)'
      ],
      borderColor: [
        'rgba(92, 38, 132, 1)',
        'rgba(255, 99, 132, 1)',
        'rgba(54, 162, 235, 1)',
        'rgba(75, 192, 192, 1)'
      ],
      borderWidth: 1,
      barPercentage: 0.8,
    },
    {
      label: 'Team Pledge Target',
      data: sortedTeams.map(([team]) => teamPledges[team] || 0),
      type: 'line',
      borderColor: 'rgba(255, 159, 64, 1)',
      borderWidth: 2,
      borderDash: [5, 5],
      fill: false,
      pointStyle: 'rectRot',
      pointRadius: 6,
      pointBorderColor: 'rgba(255, 159, 64, 1)',
      pointBackgroundColor: 'rgba(255, 159, 64, 0.5)',
    }
  ];

  teamBarChart.update();
}

// Modify the updateDashboardWithData function to include the new bar chart
function updateDashboardWithData(distributions) {
  const totalBooks = distributions.reduce((sum, dist) => sum + (parseInt(dist.quantity) || 0), 0);
  const uniqueDistributors = [...new Set(distributions.map(d => d.distributor))];
  const today = new Date().toISOString().split('T')[0];
  const todayDistribution = distributions
    .filter(d => d.date === today)
    .reduce((sum, dist) => sum + (parseInt(dist.quantity) || 0), 0);

  document.getElementById('total-books').textContent = totalBooks;
  document.getElementById('total-distributors').textContent = uniqueDistributors.length;
  document.getElementById('today-distribution').textContent = todayDistribution;

  const goalProgress = (totalBooks / 100000) * 100;
  document.getElementById('goal-progress').style.width = `${Math.min(goalProgress, 100)}%`;
  document.getElementById('progress-text').textContent = `${goalProgress.toFixed(1)}%`;

  updateDistributorList(distributions);
  updatePledgesList(distributions); // Add this line

  const distributorTotals = distributions.reduce((acc, dist) => {
    acc[dist.distributor] = (acc[dist.distributor] || 0) + (parseInt(dist.quantity) || 0);
    return acc;
  }, {});

  const topDistributor = Object.entries(distributorTotals)
    .sort(([,a], [,b]) => b - a)[0];

  if (topDistributor) {
    document.getElementById('top-distributor').textContent = 
      `${topDistributor[0]} (${topDistributor[1]} books)`;
  }

  updateChart(distributions);
  updateTeamBarChart(distributions); // Added line to update team bar chart
}

function populateDistributorFilter(distributions) {
  const select = document.getElementById('distributor-filter');
  const uniqueDistributors = [...new Set(distributions.map(d => d.distributor))];
  
  select.innerHTML = '<option value="">All Distributors</option>';
  
  uniqueDistributors
    .sort()
    .forEach(distributor => {
      const option = document.createElement('option');
      option.value = distributor;
      option.textContent = distributor;
      select.appendChild(option);
    });
}

function updateDistributorSelect(distributions) {
  const select = document.getElementById('distributor-name');
  
  const defaultOptions = `
    <option value="">Select Distributor</option>
    <option value="other" style="color: #5c2684; font-weight: 500;">+ Add New Distributor</option>
  `;
  
  const uniqueDistributors = [...new Set(distributions.map(d => d.distributor))]
    .filter(d => d)
    .sort();
  
  const optionsHTML = uniqueDistributors
    .map(distributor => `<option value="${distributor}">${distributor}</option>`)
    .join('');
  
  select.innerHTML = defaultOptions + optionsHTML;
}

function updateDistributorSelectByTeam(team, distributions) {
  const select = document.getElementById('distributor-name');
  
  const defaultOptions = `
    <option value="">Select Distributor</option>
    <option value="other" style="color: #5c2684; font-weight: 500;">+ Add New Distributor</option>
  `;
  
  const teamDistributors = [...new Set(
    distributions
      .filter(d => d.marathonType === team)
      .map(d => d.distributor)
  )]
    .filter(d => d)
    .sort();
  
  const optionsHTML = teamDistributors
    .map(distributor => `<option value="${distributor}">${distributor}</option>`)
    .join('');
  
  select.innerHTML = defaultOptions + optionsHTML;
}

function updateSubteamSelect(team) {
  const subteamSelect = document.getElementById('subteam');
  const defaultOptions = `
    <option value="">Select Subteam</option>
    <option value="other" style="color: #5c2684; font-weight: 500;">+ Add New Subteam</option>
  `;
  
  // Get distributions to find existing subteams
  const distributionsRef = window.getDbRef('distributions');
  window.onValue(distributionsRef, (snapshot) => {
    let distributions = [];
    snapshot.forEach((childSnapshot) => {
      const data = childSnapshot.val();
      if (data && data.marathonType === team && data.subteam) {
        distributions.push(data);
      }
    });
    
    // Get unique subteams for the selected team
    const subteams = [...new Set(distributions.map(d => d.subteam))]
      .filter(subteam => subteam)
      .sort();
    
    const optionsHTML = subteams
      .map(subteam => `<option value="${subteam}">${subteam}</option>`)
      .join('');
    
    subteamSelect.innerHTML = defaultOptions + optionsHTML;
  }, {
    onlyOnce: true
  });
}

function loadDistributions() {
  if (!firebaseLoaded) {
    console.log('Firebase not yet loaded');
    return;
  }

  const distributionsRef = window.getDbRef('distributions');
  
  window.onValue(distributionsRef, (snapshot) => {
    let distributions = [];
    snapshot.forEach((childSnapshot) => {
      const data = childSnapshot.val();
      if (data) {
        distributions.push({
          id: childSnapshot.key,
          ...data
        });
      }
    });

    distributions.sort((a, b) => new Date(b.date) - new Date(a.date));

    // Store current data
    window.currentFilteredData = distributions;

    updateDashboardWithData(distributions);
    updateDistributionTable(distributions);
    populateDistributorFilter(distributions);
    updateDistributorSelect(distributions);
    const marathonTypeSelect = document.getElementById('marathon-type');
    if (marathonTypeSelect) {
      updateSubteamSelect(marathonTypeSelect.value);
    }
  });
}

function updateDistributionTable(distributions) {
  const tableBody = document.querySelector('#distribution-table tbody');
  const paginationContainer = document.getElementById('pagination-container');
  
  tableBody.innerHTML = '';
  
  const totalItems = distributions.length;
  const totalPages = rowsPerPage === 'all' ? 1 : Math.ceil(totalItems / parseInt(rowsPerPage));
  
  let itemsToShow;
  if (rowsPerPage === 'all') {
    itemsToShow = distributions;
  } else {
    const startIndex = (currentPage - 1) * rowsPerPage;
    const endIndex = startIndex + parseInt(rowsPerPage);
    itemsToShow = distributions.slice(startIndex, endIndex);
  }
  
  itemsToShow.forEach((dist, index) => {
    const row = document.createElement('tr');
    const actualIndex = rowsPerPage === 'all' ? 
      index + 1 : 
      (currentPage - 1) * rowsPerPage + index + 1;

    // Format the date from yyyy-mm-dd to dd-mm-yyyy
    const [year, month, day] = dist.date.split('-');
    const formattedDate = `${day}-${month}-${year}`;

    // Only show action column if authenticated
    const actionColumn = window.isAuthenticated ? 
      `<td class="action-icons" style="display: flex;">
        <button class="icon-button edit-icon" onclick="editDistribution('${dist.id}')" title="Edit">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
        </button>
        <button class="icon-button delete-icon" onclick="deleteDistribution('${dist.id}')" title="Delete">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
        </button>
      </td>` :
      '<td class="action-icons" style="display: none;">-</td>';

    row.innerHTML = `
      <td>${actualIndex}</td>
      <td>${formattedDate}</td>
      <td>${dist.marathonType}</td>
      <td>${dist.subteam}</td>
      <td>${dist.distributor}</td>
      <td>${dist.quantity}</td>
      ${actionColumn}
    `;
    tableBody.appendChild(row);
  });
  
  updatePagination(totalItems);
}

function updatePagination(totalItems) {
  const paginationContainer = document.getElementById('pagination-container');
  if (!paginationContainer) return;

  // Clear previous pagination
  paginationContainer.innerHTML = '';

  if (rowsPerPage === 'all') {
    // If showing all items, just show the total count
    paginationContainer.innerHTML = `
      <div class="entries-per-page">
        <span>Show</span>
        <select onchange="changeRowsPerPage(this.value)">
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="all" selected>All</option>
        </select>
        <span>entries</span>
      </div>
      <div class="page-info">Showing all ${totalItems} entries</div>
    `;
    return;
  }

  const totalPages = Math.ceil(totalItems / parseInt(rowsPerPage));
  
  // Show entries per page selector
  let html = `
    <div class="entries-per-page">
      <span>Show</span>
      <select onchange="changeRowsPerPage(this.value)">
        <option value="10" ${rowsPerPage === '10' ? 'selected' : ''}>10</option>
        <option value="25" ${rowsPerPage === '25' ? 'selected' : ''}>25</option>
        <option value="50" ${rowsPerPage === '50' ? 'selected' : ''}>50</option>
        <option value="all">All</option>
      </select>
      <span>entries</span>
    </div>
  `;

  // Add pagination controls
  html += '<div class="pagination">';
  
  // Previous button
  html += `
    <button onclick="changePage(${currentPage - 1})" 
            ${currentPage === 1 ? 'disabled' : ''}>
      Previous
    </button>
  `;

  // Page numbers
  const startItem = ((currentPage - 1) * parseInt(rowsPerPage)) + 1;
  const endItem = Math.min(startItem + parseInt(rowsPerPage) - 1, totalItems);
  
  html += `
    <span class="page-info">
      Showing ${startItem} to ${endItem} of ${totalItems} entries
    </span>
  `;

  // Next button
  html += `
    <button onclick="changePage(${currentPage + 1})" 
            ${currentPage >= totalPages ? 'disabled' : ''}>
      Next
    </button>
  `;

  html += '</div>';
  
  paginationContainer.innerHTML = html;
}

function editDistribution(id) {
  if (!window.isAuthenticated) {
    alert('Please login to edit distribution data');
    return;
  }
  
  if (!id || !window.getDbRef) return;
  
  const distributionsRef = window.getDbRef(`distributions/${id}`);
  window.onValue(distributionsRef, async (snapshot) => {
    const data = snapshot.val();
    if (data) {
      const dataInput = document.querySelector('.data-input');
      if (!dataInput) return;
      
      dataInput.classList.add('show');
      
      // Get all form elements with null checks
      const marathonTypeSelect = document.getElementById('marathon-type');
      const subteamSelect = document.getElementById('subteam');
      const distributorSelect = document.getElementById('distributor-name');
      const quantityInput = document.getElementById('quantity');
      const dateInput = document.getElementById('distribution-date');
      const pledgeInput = document.getElementById('distributor-pledge');
      const form = document.getElementById('distribution-form');
      const marathonTypeNew = document.getElementById('marathon-type-new');
      const distributorNameNew = document.getElementById('distributor-name-new');
      const subteamNew = document.getElementById('subteam-new');
      
      if (!marathonTypeSelect || !subteamSelect || !distributorSelect || !quantityInput || 
          !dateInput || !form || !marathonTypeNew || !distributorNameNew || !subteamNew) return;
      
      // Set values with null checks
      marathonTypeSelect.value = data.marathonType || '';
      subteamSelect.value = data.subteam || '';
      
      // Wait for team-specific distributors to load
      try {
        await new Promise((resolve) => {
          const distributionsRef = window.getDbRef('distributions');
          window.onValue(distributionsRef, (snapshot) => {
            let distributions = [];
            snapshot.forEach((childSnapshot) => {
              const dist = childSnapshot.val();
              if (dist) {
                distributions.push({
                  id: childSnapshot.key,
                  ...dist
                });
              }
            });
            
            updateDistributorSelectByTeam(data.marathonType, distributions);
            updateSubteamSelect(data.marathonType); // Update subteams for selected team
            resolve();
          }, {
            onlyOnce: true
          });
        });
      } catch (error) {
        console.error('Error loading team distributors:', error);
      }
      
      distributorSelect.value = data.distributor || '';
      quantityInput.value = data.quantity || '';
      dateInput.value = data.date || '';
      pledgeInput.value = data.pledge || '';
      form.setAttribute('data-edit-id', id);
      
      marathonTypeNew.style.display = 'none';
      distributorNameNew.style.display = 'none';
      subteamNew.style.display = 'none';
      marathonTypeNew.value = '';
      distributorNameNew.value = '';
      subteamNew.value = '';

      // Scroll to form with null check
      if (dataInput) {
        dataInput.scrollIntoView({ 
          behavior: 'smooth',
          block: 'start'
        });
      }
    }
  }, {
    onlyOnce: true
  });
}

function deleteDistribution(id) {
  if (!window.isAuthenticated) {
    alert('Please login to delete distribution data');
    return;
  }
  window.deleteId = id; // Store the ID temporarily
  document.getElementById('deleteModal').style.display = 'block';
}

function closeDeleteModal() {
  const modal = document.getElementById('deleteModal');
  if (!modal) return;
  modal.style.display = 'none';
}

function confirmDelete() {
  const id = window.deleteId;
  if (id && window.remove) {
    const distributionsRef = window.getDbRef(`distributions/${id}`);
    if (distributionsRef) {
      window.remove(distributionsRef)
        .catch((error) => {
          console.error('Error deleting distribution:', error);
        });
      closeDeleteModal();
    }
  }
}

// Close modal when clicking outside
document.addEventListener('DOMContentLoaded', () => {
  const modalOverlay = document.querySelector('.modal-overlay');
  if (modalOverlay) {
    modalOverlay.addEventListener('click', function(e) {
      if (e.target === this) {
        closeDeleteModal();
      }
    });
  }
  
  const loginForm = document.getElementById('loginForm');
  if (loginForm) {
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('loginEmail')?.value;
      const password = document.getElementById('loginPassword')?.value;
      const errorDiv = document.getElementById('loginError');
      
      if (!email || !password) {
        if (errorDiv) {
          errorDiv.textContent = 'Please provide both email and password';
          errorDiv.style.display = 'block';
        }
        return;
      }
      
      try {
        // Use the global functions
        await window.signInWithEmailAndPassword(window.auth, email, password);
        closeLoginModal();
        if (loginForm) loginForm.reset();
        if (errorDiv) errorDiv.style.display = 'none';
      } catch (error) {
        if (errorDiv) {
          errorDiv.textContent = error.message;
          errorDiv.style.display = 'block';
        }
      }
    });
  }

  const marathonType = document.getElementById('marathon-type');
  if (marathonType) {
    marathonType.addEventListener('change', function(e) {
      const newTeamInput = document.getElementById('marathon-type-new');
      const subteamSelect = document.getElementById('subteam');
      if (!newTeamInput) return;
      
      newTeamInput.style.display = this.value === 'other' ? 'block' : 'none';
      if (this.value !== 'other') {
        newTeamInput.value = '';
        updateSubteamSelect(this.value); // Update the subteam select
      }
    });
  }

  const subteam = document.getElementById('subteam');
  if (subteam) {
    subteam.addEventListener('change', function(e) {
      const newSubteamInput = document.getElementById('subteam-new');
      newSubteamInput.style.display = this.value === 'other' ? 'block' : 'none';
      if (this.value !== 'other') {
        newSubteamInput.value = '';
      }
    });
  }

  const distributorName = document.getElementById('distributor-name');
  if (distributorName) {
    distributorName.addEventListener('change', function(e) {
      const newDistributorInput = document.getElementById('distributor-name-new');
      const pledgeInput = document.getElementById('distributor-pledge');
      
      if (this.value === 'other') {
        newDistributorInput.style.display = 'block';
        pledgeInput.style.display = 'block';
      } else {
        newDistributorInput.style.display = 'none';
        pledgeInput.style.display = 'none';
        newDistributorInput.value = '';
        pledgeInput.value = '';
      }
    });
  }

  // Set default date to today for the date input
  const today = new Date().toISOString().split('T')[0];
  const dateInput = document.getElementById('distribution-date');
  if (dateInput) {
    dateInput.value = today;
  }

  // Initialize other functionality...
  const savedRowsPerPage = localStorage.getItem('rowsPerPage');
  if (savedRowsPerPage) {
    rowsPerPage = savedRowsPerPage;
    const select = document.querySelector('.entries-per-page select');
    if (select) {
      select.value = savedRowsPerPage;
    }
  }
  
  if (firebaseLoaded) {
    loadDistributions();
  }

  // Initial hiding of add button on page load
  const addBtn = document.querySelector('.add-btn');
  if (addBtn) {
    addBtn.style.display = 'none';
  }

  // Add CSV import handler
  const csvImport = document.getElementById('csv-import');
  if (csvImport) {
    csvImport.addEventListener('change', handleCSVImport);
  }
});

// Function to handle CSV Import
function handleCSVImport(event) {
  const file = event.target.files[0];
  if (!file) return;

  if (!window.isAuthenticated) {
    alert('Please login to import distribution data');
    event.target.value = ''; // Clear the file input
    return;
  }

  const reader = new FileReader();
  reader.onload = async function(e) {
    try {
      const text = e.target.result;
      const lines = text.split('\n');
      
      // Remove header row and empty lines
      const rows = lines.slice(1).filter(line => line.trim());
      
      let successCount = 0;
      let errorCount = 0;
      
      for (const row of rows) {
        const [dateStr, marathonType, subteam, distributor, quantityStr] = row.split(',').map(cell => cell.trim());
        
        // Convert date from DD-MM-YYYY to YYYY-MM-DD
        const [day, month, year] = dateStr.split('-');
        const date = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
        
        const quantity = parseInt(quantityStr);
        
        if (!date || !marathonType || !subteam || !distributor || isNaN(quantity)) {
          errorCount++;
          continue;
        }

        try {
          const distribution = {
            marathonType,
            subteam,
            distributor,
            quantity,
            date,
            timestamp: window.serverTimestamp()
          };

          const distributionsRef = window.getDbRef('distributions');
          await window.push(distributionsRef, distribution);
          successCount++;
        } catch (error) {
          console.error('Error importing row:', error);
          errorCount++;
        }
      }

      alert(`Import completed!\nSuccessfully imported: ${successCount} records\nFailed to import: ${errorCount} records`);
      event.target.value = ''; // Clear the file input
      
      // Close the form after successful import
      document.querySelector('.data-input').classList.remove('show');
      
    } catch (error) {
      console.error('Error processing CSV:', error);
      alert('Error processing CSV file. Please check the format and try again.');
      event.target.value = ''; // Clear the file input
    }
  };

  reader.readAsText(file);
}

function changeRowsPerPage(value) {
  rowsPerPage = value;
  currentPage = 1;
  localStorage.setItem('rowsPerPage', value);
  loadDistributions();
}

function changePage(page) {
  if (rowsPerPage === 'all') return;
  currentPage = page;
  loadDistributions();
}

function applyFilters() {
  if (!firebaseLoaded) {
    console.log('Firebase not yet loaded');
    return;
  }

  const startDate = document.getElementById('start-date');
  const endDate = document.getElementById('end-date');
  const distributorFilter = document.getElementById('distributor-filter');
  const marathonFilter = document.getElementById('marathon-type-filter');

  // Guard against any null elements
  if (!startDate || !endDate || !distributorFilter || !marathonFilter) {
    console.log('Required filter elements not found');
    return;
  }

  const distributionsRef = window.getDbRef('distributions');
  
  window.onValue(distributionsRef, (snapshot) => {
    let distributions = [];
    snapshot.forEach((childSnapshot) => {
      const data = childSnapshot.val();
      if (data) {
        distributions.push({
          id: childSnapshot.key,
          ...data
        });
      }
    });

    distributions.sort((a, b) => new Date(b.date) - new Date(a.date));

    const filteredDistributions = distributions.filter(dist => {
      let includeRecord = true;

      if (startDate.value && dist.date < startDate.value) includeRecord = false;
      if (endDate.value && dist.date > endDate.value) includeRecord = false;
      if (distributorFilter.value && dist.distributor !== distributorFilter.value) includeRecord = false;
      if (marathonFilter.value && dist.marathonType !== marathonFilter.value) includeRecord = false;

      return includeRecord;
    });

    currentPage = 1;

    // Store filtered data
    window.currentFilteredData = filteredDistributions;

    updateDashboardWithData(filteredDistributions);
    updateDistributionTable(filteredDistributions);
    populateDistributorFilter(filteredDistributions);
    updateDistributorSelect(filteredDistributions);
  });
}

function clearFilters() {
  if (!firebaseLoaded) {
    console.log('Firebase not yet loaded');
    return;
  }
  
  const elements = [
    'start-date',
    'end-date',
    'distributor-filter',
    'marathon-type-filter'
  ].map(id => document.getElementById(id));
  
  // Check if all elements exist
  if (elements.some(el => !el)) {
    console.log('Some filter elements not found');
    return;
  }
  
  elements.forEach(el => el.value = '');
  loadDistributions();
}

// Function to export data to CSV
function exportToCSV() {
  if (!window.isAuthenticated) {
    alert('Please login to export data');
    return;
  }
  
  // Get filtered data or all data if no filters
  const dataToExport = window.currentFilteredData || [];

  // Generate filename based on filters
  let filename = 'book-distribution';
  
  const startDate = document.getElementById('start-date')?.value;
  const endDate = document.getElementById('end-date')?.value;
  const distributor = document.getElementById('distributor-filter')?.value;
  const team = document.getElementById('marathon-type-filter')?.value;

  if (startDate && endDate) {
    const formatDateForFilename = (dateStr) => {
      const [year, month, day] = dateStr.split('-');
      return `${day}-${month}-${year}`;
    };
    filename += `_${formatDateForFilename(startDate)}_to_${formatDateForFilename(endDate)}`;
  } else if (startDate) {
    const [year, month, day] = startDate.split('-');
    filename += `_from_${day}-${month}-${year}`;
  } else if (endDate) {
    const [year, month, day] = endDate.split('-');
    filename += `_until_${day}-${month}-${year}`;
  }

  // Create CSV content
  const csvContent = [
    ['Date', 'Marathon Team', 'Subteam', 'Distributor', 'Quantity'], // Headers
    ...dataToExport.map(item => {
      const [year, month, day] = item.date.split('-');
      const formattedDate = `${day}-${month}-${year}`;
      return [
        formattedDate,
        item.marathonType,
        item.subteam,
        item.distributor,
        item.quantity,
        item.pledge || ''
      ];
    })
  ]
  .map(row => row.map(cell => `"${cell || ''}"`).join(','))
  .join('\n');

  // Create download link
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  
  if (navigator.msSaveBlob) { // IE 10+
    navigator.msSaveBlob(blob, filename);
  } else {
    link.href = URL.createObjectURL(blob);
    link.setAttribute('download', filename);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }
}

// Add this helper function to close the login modal
function closeLoginModal() {
  const loginModal = document.getElementById('loginModal');
  if (loginModal) {
    loginModal.style.display = 'none';
  }
}

// Function to toggle form visibility
function toggleForm(formClass) {
  const filterContainer = document.querySelector('.filter-container');
  const dataInput = document.querySelector('.data-input');
  
  if (!filterContainer || !dataInput) return; // Guard against null elements
  
  if (formClass === 'filter-container') {
    filterContainer.classList.toggle('show');
    if (dataInput.classList.contains('show')) {
      dataInput.classList.remove('show');
    }
  } else if (formClass === 'data-input') {
    dataInput.classList.toggle('show');
    if (filterContainer.classList.contains('show')) {
      filterContainer.classList.remove('show');
    }
    // Set default date to today when showing the form
    const today = new Date().toISOString().split('T')[0];
    const dateInput = document.getElementById('distribution-date');
    if (dateInput && !dateInput.value) {
      dateInput.value = today;
    }
  }
}

// Function to toggle distributors list visibility with null checks
function toggleDistributorsList() {
  const list = document.getElementById('distributor-list');
  const button = document.getElementById('toggle-distributors');
  
  if (!list || !button) return; // Guard against null elements
  
  list.classList.toggle('show');
  button.classList.toggle('active');
}

// Function to toggle pledges list visibility with null checks
function togglePledgesList() {
  const list = document.getElementById('pledge-list');
  const button = document.getElementById('toggle-pledges');
  
  if (!list || !button) return;
  
  list.classList.toggle('show');
  button.classList.toggle('active');
}

function updatePledgesList(distributions) {
  const list = document.getElementById('pledge-list');
  if (!list) return;

  // Group pledges by team
  const teamPledges = distributions.reduce((acc, dist) => {
    if (dist.pledge && dist.marathonType) {
      if (!acc[dist.marathonType]) {
        acc[dist.marathonType] = new Map();
      }
      acc[dist.marathonType].set(dist.distributor, dist.pledge);
    }
    return acc;
  }, {});

  // Clear existing list
  list.innerHTML = '';

  // Check if there are any pledges
  if (Object.keys(teamPledges).length === 0) {
    list.innerHTML = '<div class="no-data">No pledges found</div>';
    return;
  }

  // Calculate team totals
  const teamTotals = {};
  Object.entries(teamPledges).forEach(([team, distributors]) => {
    teamTotals[team] = Array.from(distributors.values()).reduce((sum, pledge) => sum + parseInt(pledge), 0);
  });

  // Create team-wise grouping with team numbering
  Object.entries(teamPledges)
    .sort(([a], [b]) => a.localeCompare(b)) // Sort teams alphabetically
    .forEach(([team, pledges], teamIndex) => {
      if (team && pledges.size > 0) {
        const teamDiv = document.createElement('div');
        teamDiv.className = 'team-distributors';
        
        const teamName = document.createElement('div');
        teamName.className = 'team-name';
        teamName.textContent = `${teamIndex + 1}. ${team} (${teamTotals[team]} books pledged)`; // Add team number and total pledges
        
        const pledgesList = document.createElement('div');
        pledgesList.className = 'team-members';
        
        // Convert Map entries to array and sort
        Array.from(pledges.entries())
          .sort(([a], [b]) => a.localeCompare(b)) // Sort distributors alphabetically
          .forEach(([distributor, pledge], index) => {
            if (distributor && pledge) {
              const pledgeItem = document.createElement('div');
              pledgeItem.className = 'distributor-name';
              pledgeItem.textContent = `${index + 1}. ${distributor} (${pledge} books pledged)`;
              pledgesList.appendChild(pledgeItem);
            }
          });
        
        teamDiv.appendChild(teamName);
        teamDiv.appendChild(pledgesList);
        list.appendChild(teamDiv);
      }
    });

  // Add animation
  list.querySelectorAll('.team-distributors').forEach((team, index) => {
    team.style.animationDelay = `${index * 0.1}s`;
    team.classList.add('fade-in');
  });
}

function updateDistributorList(distributions) {
  const list = document.getElementById('distributor-list');
  if (!list) return;

  // Group distributors by team and calculate scores
  const teamDistributors = distributions.reduce((acc, dist) => {
    const team = dist.marathonType;
    const distributor = dist.distributor;
    
    if (!acc[team]) {
      acc[team] = new Map(); // Use Map to store distributor and their total
    }
    
    const currentTotal = acc[team].get(distributor) || 0;
    acc[team].set(distributor, currentTotal + (parseInt(dist.quantity) || 0));
    
    return acc;
  }, {});

  // Calculate team totals
  const teamTotals = {};
  Object.entries(teamDistributors).forEach(([team, distributors]) => {
    teamTotals[team] = Array.from(distributors.values()).reduce((sum, score) => sum + score, 0);
  });

  // Clear existing list
  list.innerHTML = '';

  // Check if there are any distributors
  if (Object.keys(teamDistributors).length === 0) {
    list.innerHTML = '<div class="no-data">No distributors found</div>';
    return;
  }

  // Create team-wise grouping with team numbering and scores
  Object.entries(teamDistributors)
    .sort(([a], [b]) => a.localeCompare(b)) // Sort teams alphabetically
    .forEach(([team, distributors], teamIndex) => {
      if (team && distributors.size > 0) {
        const teamDiv = document.createElement('div');
        teamDiv.className = 'team-distributors';
        
        const teamName = document.createElement('div');
        teamName.className = 'team-name';
        teamName.textContent = `${teamIndex + 1}. ${team} (${teamTotals[team]} books)`; // Add team number and total
        
        const membersList = document.createElement('div');
        membersList.className = 'team-members';
        
        // Convert Map entries to array and sort by score in descending order
        Array.from(distributors.entries())
          .sort(([, a], [, b]) => b - a) // Sort by score
          .forEach(([distributor, score], index) => {
            if (distributor) {
              const distributorDiv = document.createElement('div');
              distributorDiv.className = 'distributor-name';
              distributorDiv.textContent = `${index + 1}. ${distributor} (${score} books)`;
              membersList.appendChild(distributorDiv);
            }
          });
        
        teamDiv.appendChild(teamName);
        teamDiv.appendChild(membersList);
        list.appendChild(teamDiv);
      }
    });

  // Add animation
  list.querySelectorAll('.team-distributors').forEach((team, index) => {
    team.style.animationDelay = `${index * 0.1}s`;
    team.classList.add('fade-in');
  });
}
</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getDatabase, ref, push, onValue, serverTimestamp, set, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
  import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

  window.auth = null; // Add this line to store auth globally
  window.signInWithEmailAndPassword = null; // Add this line to store the function globally

  const firebaseConfig = {
    apiKey: "AIzaSyCUuktFF02u4OlgFf4JJJfhRdhP7g-OS-0",
    authDomain: "gita-marathon.firebaseapp.com",
    databaseURL: "https://gita-marathon-default-rtdb.firebaseio.com",
    projectId: "gita-marathon",
    storageBucket: "gita-marathon.appspot.com",
    messagingSenderId: "116315685191",
    appId: "1:116315685191:web:eacf30cd09f7a167c64c62"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const auth = getAuth(app);

  // Store auth and signInWithEmailAndPassword globally
  window.auth = auth;
  window.signInWithEmailAndPassword = signInWithEmailAndPassword;

  window.onValue = onValue;
  window.ref = ref;
  window.getDbRef = function(path) {
    return ref(database, path);
  };
  window.serverTimestamp = serverTimestamp;
  window.push = push;
  window.set = set;
  window.remove = remove;
  firebaseLoaded = true;

  window.isAuthenticated = false;

  // Update the auth state listener
  onAuthStateChanged(auth, (user) => {
    const loginBtn = document.getElementById('loginBtn');
    const loginBtnText = document.getElementById('loginBtnText');
    const addBtn = document.querySelector('.add-btn');
    const exportBtn = document.querySelector('.export-btn'); // Add this line
    
    if (user) {
      window.isAuthenticated = true;
      loginBtnText.textContent = 'Logout';  
      loginBtn.onclick = handleSignOut;
      if (addBtn) addBtn.style.display = 'flex';
      if (exportBtn) exportBtn.style.display = 'block'; // Add this line
      
      // Reload distributions to show actions
      loadDistributions();
    } else {
      window.isAuthenticated = false;
      loginBtnText.textContent = 'Login';
      loginBtn.onclick = handleSignIn;
      if (addBtn) addBtn.style.display = 'none';
      if (exportBtn) exportBtn.style.display = 'none'; // Add this line
      
      // Reload distributions to hide actions
      loadDistributions();
    }
  });

  // Add auth handlers
  async function handleSignOut() {
    try {
      await signOut(auth);
    } catch (error) {
      console.error('Error signing out:', error);
    }
  }

  // Add this in the type="module" script section
  function handleSignIn() {
    const loginModal = document.getElementById('loginModal');
    if (loginModal) {
      loginModal.style.display = 'block';
    }
  }

  // Make these functions globally available
  window.handleSignIn = handleSignIn;
  window.closeLoginModal = closeLoginModal;

  document.addEventListener('DOMContentLoaded', () => {
    const savedRowsPerPage = localStorage.getItem('rowsPerPage');
    if (savedRowsPerPage) {
      rowsPerPage = savedRowsPerPage;
      const select = document.querySelector('.entries-per-page select');
      if (select) {
        select.value = savedRowsPerPage;
      }
    }
    
    if (firebaseLoaded) {
      loadDistributions();
    }
  });

  document.getElementById('distribution-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    if (!window.isAuthenticated) {
      alert('Please login to add or update distribution data');
      return;
    }

    const marathonType = document.getElementById('marathon-type').value === 'other' 
      ? document.getElementById('marathon-type-new').value 
      : document.getElementById('marathon-type').value;
    
    const subteam = document.getElementById('subteam').value === 'other'
      ? document.getElementById('subteam-new').value
      : document.getElementById('subteam').value;
      
    const distributorName = document.getElementById('distributor-name').value === 'other'
      ? document.getElementById('distributor-name-new').value
      : document.getElementById('distributor-name').value;
      
    const quantity = parseInt(document.getElementById('quantity').value);
    const date = document.getElementById('distribution-date').value;
    const pledge = document.getElementById('distributor-pledge').value;

    if (!marathonType || !subteam || !distributorName || !quantity || !date) {
      alert('Please fill all required fields');
      return;
    }

    const distribution = {
      marathonType,
      subteam,
      distributor: distributorName,
      quantity,
      date,
      pledge: distributorName === document.getElementById('distributor-name-new').value ? pledge : null,
      timestamp: window.serverTimestamp()
    };

    const editId = this.getAttribute('data-edit-id');
    
    try {
      if (editId) {
        const updateRef = window.getDbRef(`distributions/${editId}`);
        await window.set(updateRef, distribution);
        this.removeAttribute('data-edit-id');
      } else {
        const distributionsRef = window.getDbRef('distributions');
        await window.push(distributionsRef, distribution);

        // If it's a new distributor, store their pledge separately
        if (distributorName === document.getElementById('distributor-name-new').value && pledge) {
          const pledgesRef = window.getDbRef('pledges');
          await window.push(pledgesRef, {
            distributor: distributorName,
            pledge: pledge,
            timestamp: window.serverTimestamp()
          });
        }
      }

      this.reset();
      document.getElementById('marathon-type-new').style.display = 'none';
      document.getElementById('subteam-new').style.display = 'none';
      document.getElementById('distributor-pledge').style.display = 'none';
      document.querySelector('.data-input').classList.remove('show');
      
    } catch (error) {
      console.error('Error managing distribution:', error);
      alert('Error managing distribution. Please try again.');
    }
  });
</script>
</head>
<body>

<div class="dashboard">
  <div class="mantra-marquee">
    <div class="mantra-text">
      “DISTRIBUTING THE BOOKS WILL MAKE DEVOTEES” - Srila Prabhupada 🙏
    </div>
  </div>
  
  <div class="header">
    <div class="auth-container">
      <button id="loginBtn" class="auth-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M13.8 12H3"/>
        </svg>
        <span id="loginBtnText">Login</span>
      </button>
    </div>
    <h1 style="padding-top: 20px;">ISKCON Jaipur Gita Marathon</h1>
    <p>Track and monitor book distribution progress</p>
  </div>

  <div class="action-buttons">
    <button onclick="toggleForm('filter-container')" class="icon-button filter-btn">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M3 4h18v2H3V4zm0 7h12v2H3v-2zm0 7h8v2H3z"/>
      </svg>
      Filter
    </button>
    <button onclick="toggleForm('data-input')" class="icon-button add-btn">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
      </svg>
      Add
    </button>
  </div>

  <div class="filter-container">
    <h2>Filter Distribution Data</h2>
    <div class="form-group">
      <label>Start Date</label>
      <input type="date" id="start-date">
    </div>
    <div class="form-group">
      <label>End Date</label>
      <input type="date" id="end-date">
    </div>
    <div class="form-group">
      <label>Distributor</label>
      <select id="distributor-filter">
        <option value="">All Distributors</option>
      </select>
    </div>
    <div class="form-group">
      <label>Marathon Team</label>
      <select id="marathon-type-filter">
        <option value="">All Teams</option>
        <option value="IYF Team">IYF Team</option>
        <option value="IGF Team">IGF Team</option>
        <option value="Muralipura Bhakti Vriksha">Muralipura Bhakti Vriksha</option>
        <option value="IYF Bhakti Vriksha">IYF Bhakti Vriksha</option>
      </select>
    </div>
    <div class="button-group">
      <button onclick="applyFilters()">Apply Filters</button>
      <button onclick="clearFilters()" class="clear-btn">Clear Filters</button>
      <button class="export-btn" onclick="exportToCSV()">Export to CSV</button>
    </div>
  </div>

  <div class="data-input">
    <h2>Enter Distribution Data</h2>
    <form id="distribution-form">
      <div class="form-group">
        <label>Marathon Team</label>
        <select id="marathon-type" required>
          <option value="">Select Marathon Team</option>
          <option value="other" style="color: #5c2684; font-weight: 500;">+ Add New Team</option>
          <option value="IYF Team">IYF Team</option>
          <option value="IGF Team">IGF Team</option>
          <option value="Muralipura Bhakti Vriksha">Muralipura Bhakti Vriksha</option>
          <option value="IYF Bhakti Vriksha">IYF Bhakti Vriksha</option>
        </select>
        <input type="text" id="marathon-type-new" placeholder="Enter new team name" style="display: none; margin-top: 10px;">
      </div>
      <div class="form-group">
        <label>Subteam</label>
        <select id="subteam" required>
          <option value="">Select Subteam</option>
          <option value="other" style="color: #5c2684; font-weight: 500;">+ Add New Subteam</option>
        </select>
        <input type="text" id="subteam-new" placeholder="Enter new subteam name" style="display: none; margin-top: 10px;">
      </div>
      <div class="form-group">
        <label>Distributor Name</label>
        <select id="distributor-name" required>
          <option value="">Select Distributor</option>
          <option value="other" style="color: #5c2684; font-weight: 500;">+ Add New Distributor</option>
        </select>
        <input type="text" id="distributor-name-new" placeholder="Enter new distributor name" style="display: none; margin-top: 10px;">
        <input 
          type="number" 
          id="distributor-pledge" 
          placeholder="Enter distributor's book pledge"
          min="1"
          style="display: none; margin-top: 10px;"
        >
      </div>
      <div class="form-group">
        <label>Quantity</label>
        <input type="number" id="quantity" min="1" required>
      </div>
      <div class="form-group">
        <label>Date</label>
        <input type="date" id="distribution-date" required>
      </div>
      <!-- Add CSV import functionality here -->
      <div class="form-group">
        <label>Import CSV</label>
        <input type="file" id="csv-import" accept=".csv" 
               style="width: 100%; padding: 10px; border: 2px dashed #5c2684; border-radius: 12px; cursor: pointer;">
        <small style="color: #666; margin-top: 5px; display: block;">
          CSV Format: Date (DD-MM-YYYY), Marathon Team, Subteam, Distributor, Quantity
        </small>
      </div>
      <button type="submit">Submit Distribution</button>
    </form>
  </div>

  <div class="stats-grid">
    <div class="stat-card achiever-card">
      <h3 style="color: white;">Top Distributor</h3>
      <div id="top-distributor">Loading...</div>
    </div>
    <div class="stat-card">
      <h3>Total Books Distributed</h3>
      <div class="number" id="total-books">0</div>
    </div>
    <div class="stat-card">
      <h3>Total Distributors</h3>
      <div class="number" id="total-distributors">0</div>
      <button id="toggle-distributors" class="toggle-distributors" onclick="toggleDistributorsList()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
        </svg>
      </button>
      <div id="distributor-list" class="distributor-list"></div>
    </div>
    <div class="stat-card">
      <h3>Today's Distribution</h3>
      <div class="number" id="today-distribution">0</div>
    </div>
    <div class="stat-card">
      <h3>Marathon Goal</h3>
      <div class="number" id="marathon-goal">100000</div>
      <button id="toggle-pledges" class="toggle-distributors" onclick="togglePledgesList()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
        </svg>
      </button>
      <div id="pledge-list" class="distributor-list"></div>
    </div>
    <div class="stat-card">
      <h3>Progress to Goal</h3>
      <div class="progress-bar">
        <div class="progress-fill" id="goal-progress"></div>
      </div>
      <div style="margin-top: 10px;" id="progress-text">0%</div>
    </div>
  </div>

  <div class="graph-container">
    <h2>Distribution Progress</h2>
    <canvas id="distributionChart"></canvas>
  </div>

  <div class="graph-container">
    <h2>Team-wise Distribution</h2>
    <canvas id="teamBarChart"></canvas>
  </div>

  <div class="table-container">
    <h2>Recent Distributions</h2>
    <table id="distribution-table">
      <thead>
        <tr>
          <th>S.No.</th>
          <th>Date</th>
          <th>Marathon Team</th>
          <th>Subteam</th>
          <th>Distributor</th>
          <th>Quantity</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    <div id="pagination-container"></div>
  </div>
</div>

<div class="modal-overlay" id="deleteModal">
  <div class="modal-container">
    <div class="modal-header">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 11c-.55 0-1-.45-1-1V8c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1zm1 4h-2v-2h2v2z"/>
      </svg>
      <h3 class="modal-title">Delete Distribution</h3>
      <p class="modal-message">Are you sure you want to delete this distribution record? This action cannot be undone.</p>
    </div>
    <div class="modal-buttons">
      <button class="modal-btn cancel" onclick="closeDeleteModal()">Cancel</button>
      <button class="modal-btn confirm" onclick="confirmDelete()">Delete</button>
    </div>
  </div>
</div>

<div class="login-modal" id="loginModal">
  <div class="login-container">
    <button class="close-login" onclick="closeLoginModal()">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    <div class="login-header">
      <h3>Welcome Back</h3>
      <p>Sign in to access distribution management</p>
    </div>
    <form id="loginForm" class="login-form">
      <input type="email" placeholder="Email" class="login-input" id="loginEmail" required>
      <input type="password" placeholder="Password" class="login-input" id="loginPassword" required>
      <button type="submit" class="login-submit">Sign In</button>
    </form>
    <div class="login-error" id="loginError"></div>
  </div>
</div>

</body>
</html>